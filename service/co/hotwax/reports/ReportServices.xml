<?xml version="1.0" encoding="UTF-8"?>
<services xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/service-definition-3.xsd">

    <!-- TODO add comments and descriptions wherever required -->
    <service verb="get" noun="DataDocumentReport">
        <description>Service to fetch data from the Data Document Report.</description>
        <in-parameters>
            <parameter name="dataDocumentId" required="true"/>
        </in-parameters>
        <out-parameters>
            <parameter name="entityValueList" type="List"/>
        </out-parameters>
        <actions>
            <set field="entityName" from="'DataDocument.' + dataDocumentId"/>
            <!-- TODO test with search form inputs -->
            <entity-find entity-name="${entityName}" list="entityValueList" cache="false">
                <search-form-inputs/></entity-find>
        </actions>
    </service>

    <service verb="get" noun="AllEntityInfo">
        <description></description>
        <out-parameters>
            <parameter name="entityInfoList" type="List"/>
        </out-parameters>
        <actions>
            <set field="entityInfoList" from="ec.entity.getAllEntitiesInfo('entityName', null, false, true)"/>
        </actions>
    </service>

    <service verb="get" noun="EntityFields">
        <description></description>
        <in-parameters>
            <parameter name="entityName" required="true"/>
        </in-parameters>
        <out-parameters>
            <parameter name="fieldList" type="List"/>
        </out-parameters>
        <actions>
            <set field="entityDef" from="ec.entity.getEntityDefinition(entityName)"/>

            <set field="fieldList" from="entityDef?.getAllFieldNames()"/>
        </actions>
    </service>

    <service verb="get" noun="EntityRelationships">
        <description></description>
        <in-parameters>
            <parameter name="entityName" required="true"/>
        </in-parameters>
        <out-parameters>
            <parameter name="relationshipList" type="List"/>
        </out-parameters>
        <actions>
            <set field="entityDef" from="ec.entity.getEntityDefinition(entityName)"/>

            <set field="relationshipList" from="[]"/>

            <iterate list="entityDef?.getRelationshipsInfo(false)" entry="relInfo">
                <if condition="relInfo.isAutoReverse"><continue/></if>
                <script>relationshipList.add(relInfo.relatedEntityName)</script>
            </iterate>
        </actions>
    </service>
</services>